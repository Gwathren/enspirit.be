apiVersion: beta.q8s.quadrabee.com/v1
kind: WebHook
metadata:
  name: build-enspirit-website
  namespace: enspirit
spec:
  bindings:
    - name: build-enspirit-website-latest
      condition: |
        headers["x-github-event"] == "push" &&
        body.repository.full_name == "enspirit/enspirit.be" &&
        body.ref == "refs/heads/new-website"
      actions:
        - type: instantiate
          template: build-enspirit-website
          vars:
            - name: gitRepo
              value: git@github.com:enspirit/enspirit.be.git
            - name: gitRef
              value: new-website
            - name: dockerTag
              value: staging

    - name: build-enspirit-website-tags
      condition: |
        headers["x-github-event"] == "create" &&
        body.ref_type == "tag" &&
        body.repository.full_name == "enspirit/enspirit.be"
      actions:
        - type: instantiate
          template: build-enspirit-website
          vars:
            - name: gitRepo
              value: git@github.com:enspirit/enspirit.be.git
            - name: gitRef
              valueFrom: "'refs/tags/' + body.ref"
            - name: dockerTag
              valueFrom: body.ref
